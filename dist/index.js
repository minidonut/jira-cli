#!/usr/bin/env node
!function(e){var s={};function o(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=s,o.d=function(e,s,t){o.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,s){if(1&s&&(e=o(e)),8&s)return e;if(4&s&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var n in e)o.d(t,n,function(s){return e[s]}.bind(null,n));return t},o.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(s,"a",s),s},o.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},o.p="",o(o.s=0)}([function(e,s,o){"use strict";var t=this&&this.__awaiter||function(e,s,o,t){return new(o||(o=Promise))(function(n,i){function r(e){try{u(t.next(e))}catch(e){i(e)}}function a(e){try{u(t.throw(e))}catch(e){i(e)}}function u(e){e.done?n(e.value):new o(function(s){s(e.value)}).then(r,a)}u((t=t.apply(e,s||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0});const n=o(1),i=o(2),r=o(3),a=o(4),u=o(5);console.log("JIRA cli -- v1.1.0");const{JIRA_TOKEN:l,JIRA_EMAIL:c,JIRA_PROJECT_KEY:d,JIRA_ENDPOINT:m}=process.env,p=["alan","jackie","jake","joseph","jun","karl","sean","      "],f=Math.max(...p.map(e=>e.length)),g=["todo","doing","wait","review","done"],y=[11,21,51,41,31],h={"To Do":"todo","In Progress":"doing","대기":"wait","리뷰":"review",Done:"done"},v=n.default.create({baseURL:m+"/api/2",timeout:15e3,auth:{username:c,password:l}}),j=n.default.create({baseURL:m+"/agile/1.0",timeout:15e3,auth:{username:c,password:l}}),$=()=>t(this,void 0,void 0,function*(){return(yield j.get("board/16/sprint?state=active")).data.values[0]}),w=(...e)=>t(this,void 0,void 0,function*(){const s=yield $(),o=e.filter(e=>p.includes(e)),t=e.filter(e=>g.includes(e)),n=0===o.length?"":"&jql="+o.map(e=>"assignee="+e).join("%20OR%20"),i=yield j.get(`board/16/sprint/${s.id}/issue?maxResults=200${n}`),{issues:r}=i.data;return 0===t.length?r:r.filter(e=>t.includes(h[e.fields.status.name]))}),b=e=>t(this,void 0,void 0,function*(){return(yield v.get(`issue/SB-${e}`)).data}),S=e=>t(this,void 0,void 0,function*(){const s=e.filter(e=>"string"==typeof e);s.length<=1&&(console.error("Need more argument. see --help"),process.exit(0));const[o,...t]=s,n=t.join(" ");/^\d+$/.test(o)||(console.error(`\nUsage: jira [issue-id] [summary], where issue id must be number\n\ngiven: '${u.yellow(o)}'\n`),process.exit(0));try{const e=(yield v.get(`/issue/SB-${o}`)).data;yield v.put(`/issue/SB-${o}`,{fields:{summary:n}}),x.updateIssueSummary(e,n),process.exit(0)}catch(e){if(i.path(["response","status"],e)){const{response:s}=e;console.error(s.status,i.path(["data","errorMessages","0"],s))}else console.error(e)}}),x={issue:e=>{const{key:s,fields:{summary:o,assignee:t,status:{name:n}}}=e,i=t?t.name:"      ";console.log(s,x.name(i),x.status(h[n]),o)},updateIssueSummary:(e,s)=>{const{key:o,fields:{summary:t,assignee:n,status:{name:i}}}=e,r=n?n.name:"      ";console.log(o,x.name(r),x.status(h[i]),`${u.gray(t)} -> ${s}`)},updateIssueStatus:(e,s)=>{const{key:o,fields:{summary:t,assignee:n,status:{name:i}}}=e,r=n?n.name:"      ";console.log(o,x.name(r),x.status(h[i]),"->",x.status(s),t)},status:e=>{return u[{todo:"green",doing:"yellow",wait:"grey",review:"blue",done:"red"}[e]](e.padStart(6))},name:e=>u.white(e.padStart(f))},_=e=>(...s)=>t(this,void 0,void 0,function*(){const o=s[0];/^\d+$/.test(o)||(console.error(`\nUsage: jira ${e} <issue-id>, where issue id must be number\n\ngiven: '${u.yellow(o)}'\n`),process.exit(0));try{const s=(yield v.get(`/issue/SB-${o}`)).data;yield v.post(`/issue/SB-${o}/transitions`,{transition:{id:String(y[g.indexOf(e)])}}),x.updateIssueStatus(s,e)}catch(e){if(i.path(["response","status"],e)){const{response:s}=e;console.error(s.status,i.path(["data","errorMessages","0"],s))}else console.error(e)}});r.version("0.1.0","-v, --version").command("ls").description("list issues").action((...e)=>t(this,void 0,void 0,function*(){const s=e.splice(0,e.length-1);s.forEach(e=>{g.includes(e)||p.includes(e)||(console.log(`Given argument '${u.yellow(e)}' cannot be included in any of\n- users : ${p.join(", ")}\n- status: ${g.join(", ")}\n`),process.exit(0))});try{(yield w(...s)).forEach(x.issue)}catch(e){if(i.path(["response","status"],e)){const{response:s}=e;console.error(s.status,i.path(["data","errorMessages","0"],s))}else console.error(e)}})),r.command("add [user] [...rest]").description("Add a issue into current sprint").action((e,...s)=>t(this,void 0,void 0,function*(){p.includes(e)||(console.log(`First argument must be one of the users: ${p.join(", ")}`),console.log(`- given ${u.yellow(e)}`),process.exit(0));const o=s.filter(e=>"string"==typeof e);o.length<1&&(console.error("You must specify summary of a issue"),process.exit(0));const t=o.join(" ");try{const s=yield v.post("issue",{fields:{project:{id:"10016"},summary:t,issuetype:{id:"10021"},assignee:{name:e},reporter:{name:"karl"}}});console.log("Issue is successfully created");const o=i.path(["data","key"],s);if(!o)throw new Error("Issue creation failed");{const s=yield $();console.log("Set the issue's sprint..",s.id),yield j.post(`sprint/${s.id}/issue`,{issues:[o]}),x.issue({key:o,fields:{summary:t,assignee:{name:e},status:{name:"To Do"}}})}}catch(e){console.log(e)}})),r.command("rm [issue]").description("Delete a issue").action(e=>t(this,void 0,void 0,function*(){/^\d+$/.test(e)||console.error(`\nUsage: jira rm <issue-id>, where issue id must be number\n\ngiven: '${u.yellow(e)}'\n`);try{const s=yield b(e);x.issue(s),a.prompt({type:"confirm",message:`Delete SB-${e}`,name:"yes"}).then(({yes:s})=>t(this,void 0,void 0,function*(){s?yield v.delete(`issue/SB-${e}`):console.log("Bye..")}))}catch(e){console.log(e)}})),r.command("done [issue]").description("Set status of the issue 'done'").action(_("done")),r.command("wait [issue]").description("Set status of the issue 'wait'").action(_("wait")),r.command("doing [issue]").description("Set status of the issue 'doing'").action(_("doing")),r.command("review [issue]").description("Set status of the issue 'review'").action(_("review")),r.command("todo [issue]").description("Set status of the issue 'todo'").action(_("todo")),r.arguments("<id> [summary]").description("Update issue summary").action(function(...e){S(e)}),r.on("--help",function(){console.log("  [id] [summary] Update summary of issue "),console.log("\n"),console.log("Schema:"),console.log(`  - users : ${p.join(", ")}`),console.log(`  - status: ${g.join(", ")}`),console.log("\n"),console.log("Examples:"),console.log("  $ jira --help"),console.log("  $ jira ls"),console.log("  $ jira ls todo"),console.log("  $ jira ls joseph"),console.log("  $ jira ls joseph todo"),console.log("  $ jira ls karl review done"),console.log("  $ jira ls jospeh karl doing review"),console.log('  $ jira 2356 "(1.5h) ..."'),console.log("\n")}),r.parse(process.argv)},function(e,s){e.exports=require("axios")},function(e,s){e.exports=require("ramda")},function(e,s){e.exports=require("commander")},function(e,s){e.exports=require("inquirer")},function(e,s){e.exports=require("chalk")}]);